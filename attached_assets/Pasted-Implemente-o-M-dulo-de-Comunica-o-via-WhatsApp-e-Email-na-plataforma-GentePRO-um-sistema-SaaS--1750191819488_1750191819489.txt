Implemente o **MÃ³dulo de ComunicaÃ§Ã£o via WhatsApp e Email** na plataforma GentePRO, um sistema SaaS multiempresa de recrutamento e seleÃ§Ã£o. O backend Ã© em FastAPI, com banco PostgreSQL, JWT, e estrutura modular. Este mÃ³dulo serÃ¡ responsÃ¡vel por gerenciar os disparos de mensagens automÃ¡ticas relacionadas a eventos do processo seletivo.

---

### ğŸ¯ OBJETIVO DO MÃ“DULO

Permitir o envio automatizado e personalizado de mensagens para os candidatos atravÃ©s de **WhatsApp** e/ou **e-mail**, com base em eventos como:

- InscriÃ§Ã£o em vaga
- MovimentaÃ§Ã£o no pipeline
- Agendamento de entrevista
- AplicaÃ§Ã£o de testes
- Resultado de processo

---

### ğŸ§± ESTRUTURA DO BANCO

#### ğŸ”¸ Tabela `comunicacoes`

- `id`: UUID (PK)
- `candidato_id`: FK â†’ `candidatos`
- `tipo`: enum (`whatsapp`, `email`)
- `canal`: enum (`inscricao`, `pipeline`, `entrevista`, `teste`, `outros`)
- `assunto`: string
- `mensagem`: text (template)
- `status_envio`: enum (`pendente`, `enviado`, `erro`)
- `data_agendada`: datetime
- `data_envio`: datetime (null se nÃ£o enviado ainda)
- `erro`: string (opcional)
- `enviado_por`: UUID â†’ FK usuÃ¡rio que acionou ou sistema

---

### ğŸ” PERMISSÃ•ES

- `admin` e `recrutador`: podem visualizar e enviar comunicaÃ§Ãµes
- `gestor`: somente visualizaÃ§Ã£o de mensagens enviadas em suas vagas
- `candidato`: recebe mensagens (nÃ£o envia)

---

### ğŸ”Œ ENDPOINTS A IMPLEMENTAR

- `POST /comunicacoes/enviar`  
  â†’ Envia uma mensagem para um candidato (manual ou automatizada)

- `GET /comunicacoes`  
  â†’ Lista mensagens enviadas com filtros por candidato, vaga, status

- `GET /comunicacoes/{id}`  
  â†’ Detalhe de uma comunicaÃ§Ã£o

- `POST /comunicacoes/webhook/email`  
  â†’ Receber retorno de entrega (futuro)

- `POST /comunicacoes/webhook/whatsapp`  
  â†’ Webhook para delivery status via WhatsApp API (futuro)

---

### ğŸ”— INTEGRAÃ‡Ã•ES EXTERNAS

- **E-mail**: via SMTP ou serviÃ§os como SendGrid/Mailgun (usar SMTP genÃ©rico no MVP)
- **WhatsApp**: integraÃ§Ã£o com API de parceiros (ex: Z-API, Twilio, Gupshup, Facebook Cloud API)

> Para testes no Replit, simular envio com `print()` ou `logger`, armazenando `status_envio = enviado`

---

### ğŸ’¡ EXEMPLOS DE USO

1. **Pipeline**
   - Ao mover candidato de "triagem" para "entrevista", enviar WhatsApp com:  
     _â€œOlÃ¡ {{nome}}, sua entrevista estÃ¡ agendada para dia XX Ã s XXh.â€_

2. **Testes**
   - Ao aplicar um teste, disparar e-mail com link de acesso

3. **Entrevistas**
   - ConfirmaÃ§Ã£o por e-mail 24h antes da entrevista (MVP: disparo manual)

---

### ğŸ§ª REGRAS E FUNCIONALIDADES

- Utilizar templates com variÃ¡veis: `{{nome}}`, `{{vaga}}`, `{{data_entrevista}}`
- Armazenar cada envio no histÃ³rico
- Reencaminhar mensagens com erro (via PATCH)
- Enviar imediatamente ou por `data_agendada`
- Mostrar falha no painel em caso de erro

---

### ğŸ’» FRONTEND â€“ SUGESTÃ•ES DE TELAS

#### Tela: HistÃ³rico de ComunicaÃ§Ãµes
- Colunas: destinatÃ¡rio, canal, status, data envio
- Filtros: candidato, vaga, tipo, status
- AÃ§Ãµes: visualizar, reenviar

#### Tela: Nova ComunicaÃ§Ã£o (manual)
- Selecionar candidato, canal, modelo de mensagem
- PrÃ©-visualizaÃ§Ã£o com variÃ¡veis resolvidas
- BotÃ£o: â€œEnviar agoraâ€ ou â€œAgendarâ€

---

### âš™ï¸ CONSIDERAÃ‡Ã•ES TÃ‰CNICAS

- Utilizar UUID como chave primÃ¡ria
- Criar utilitÃ¡rios separados para envio por e-mail e WhatsApp
- Modularizar templates e substituir variÃ¡veis dinamicamente
- Criar `communication_service.py` com funÃ§Ã£o genÃ©rica:
```python
def enviar_comunicacao(tipo: Literal["whatsapp", "email"], candidato: Candidato, mensagem: str, assunto: Optional[str])
